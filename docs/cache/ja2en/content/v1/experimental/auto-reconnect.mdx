---
title: Auto Reconnect
slug: en/v1/experimental/auto-reconnect
banner:
  content: This is an experimental feature and the API is subject to change frequently.
---

This feature provides automatic reconnection attempts in response to connection disruptions that occur in real-time communication, such as WebSockets. It reconnects based on certain logic and emits success and failure events.

The `autoReconnect` function creates an instance of the `AutoReconnect` class, enabling you to utilize the reconnection functionality.

### Import

```ts
import { autoReconnect } from "@tai-kun/surrealdb";
```

### Syntax

```ts
function autoReconnect(
  db: Client, 
  options?: AutoReconnectOptions
): AutoReconnect;
```

#### Arguments

##### `db`

An instance object of the `Surreal` class.

##### `options`

Options for specifying reconnection settings. You can configure parameters such as reconnection interval, maximum delay time, and reconnection conditions. These options can be omitted if you wish to use the default settings.

`backoffLimit?: number`
:   Specifies the maximum number of reconnection attempts. The default value is `Infinity`.

`initialDelay?: number`
:   Delay time (in milliseconds) before the first reconnection attempt. The default value is `500`.

`maxDelay?: number`
:   The maximum value (in milliseconds) for the reconnection delay time. As the backoff progresses, the delay increases, but this value serves as the upper limit. The default value is `30_000` (30 seconds).

`shouldReconnect?: { ping?: { threshold: number; perMillis: number }} | (error) => boolean`
:   Specifies the conditions for reconnecting. If specified as a function, it determines whether to reconnect based on the arguments of the error event.

#### Return Value

Returns an instance of the `AutoReconnect` class. This instance can be used to control reconnections, retrieve status information, and monitor events.

`.getReconnectionInfo(): ReconnectionInfo`
:   Retrieves the current reconnection information (`.state` and `.phase`). Each value has the following meaning:
:   `.state`:
    - `"waiting"` ... Initial state. Reconnection has not occurred yet.
    - `"running"` ... Reconnecting.
    - `"success"` ... Reconnection succeeded.
    - `"failure"` ... Reconnection failed.
:   `.phase`:
    - `"waiting"`       ... Initial state. Reconnection has not occurred yet.
    - `"pending"`       ... Reconnection has been requested, and it is waiting for a certain period of time before execution.
    - `"disconnecting"` ... Disconnecting.
    - `"connecting"`    ... Connecting. It will attempt to connect even if the disconnection fails.
    - `"succeeded"`     ... Reconnection succeeded.
    - `"failed"`        ... Reconnection failed.

| state       | phase                           |
| ----------- | ------------------------------- |
| `"waiting"` | `"waiting"\|"pending"`          |
| `"running"` | `"disconnecting"\|"connecting"` |
| `"success"` | `"pending"\|"succeeded"`        |
| `"failure"` | `"pending"\|"failed"`           |

`.enable(): void`
:   Enables the reconnection feature. Calling this method will enable reconnections. It is enabled by default.

`.disable(): void`
:   Disables the reconnection feature. Calling this method will disable reconnections.

`.reset(): void`
:   Resets the reconnection counter. This initializes the reconnection backoff logic.

`.enabled: boolean`
:   A Boolean value indicating whether the reconnection feature is enabled. If `true`, reconnections are enabled.

### Example

```ts
import { autoReconnect, Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
const ar = autoReconnect(db, {
  initialDelay: 1000,
  maxDelay: 30000,
  backoffLimit: 5,
  shouldReconnect: {
    ping: {
      perMillis: 60000, // Within 1 minute,
      threshold: 3,     // If ping fails 3 or more times, reconnect.
    },
  },
});

ar.on("pending", (endpoint, duration) => {
  console.log(`${duration / 1000} seconds later, reconnecting to ${endpoint}...`);
});

ar.on("success", (endpoint) => {
  console.log(`Successfully reconnected to ${endpoint} ðŸŽ‰`);
});

ar.on("failure", (endpoint, cause) => {
  console.error(`Failed to reconnect to ${endpoint} ðŸ¤¯`);
  console.error("Cause:", cause);
});

try {
  await db.connect("ws://127.0.0.1:8000");

  // Various processes that run for a long time

} finally {
  await db.disconnect();
}
```

### Note

- The reconnection logic is crucial for appropriately adjusting the stability of the WebSocket connection and the frequency of connection recovery. The option settings should be adjusted according to the system requirements and use cases.
- `autoReconnect` attempts to recover when a connection is lost, but complete recovery is not guaranteed in all cases.
