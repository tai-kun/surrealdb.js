---
title: Connecting
slug: en/v1/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Importing

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Returns

When called with `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method runs asynchronously, but it will not be executed concurrently with other `.connect()` or `.disconnect()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Connection options.

`signal?: AbortSignal`
:   The abort signal to interrupt the connection. By default, an abort signal with a 15-second timeout is set.

#### Returns

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

Connecting to a different endpoint without disconnecting from the previous one is not possible. Note that the connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

`.connect()` is not executed concurrently in an asynchronous processing context, so the following example will also fail to connect. Usually, it is uncertain which endpoint will establish a connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.disconnect()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from SurrealDB. It will not throw an error if it is not yet connected or is already disconnected. This method runs asynchronously, but it will not be executed concurrently with `.connect()` or other `.disconnect()` calls within the same instance.

```ts
disconnect(options?: ClientDisconnectOptions): Promise<void>
```

#### Arguments

##### `options`

Disconnect options.

`force?: boolean`
:   If `true`, sends an abort signal to the abort signal passed to the event listener of the `Surreal` object. The event listener is expected to interrupt immediately, even if the processing is incomplete.

`signal?: AbortSignal`
:   The abort signal to interrupt the connection. By default, an abort signal with a 15-second timeout is set.

#### Returns

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol and then disconnects from it:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.disconnect();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves the connection information. The connection information always contains a value that is a copy of the internal information. Therefore, the connection information contains a `URL` object, but directly changing it will not change the endpoint information held internally by the `Surreal` object. It is `undefined` if the connection is not yet requested.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Returns

Returns the connection information if a connection has been established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: 0 | 1 | 2 | 3`
:   A number indicating the current connection state. Each number indicates the following meaning:
:   - `0` ... Connecting.
    - `1` ... Connected.
    - `2` ... Disconnecting.
    - `3` ... Disconnected.

`endpoint: URL | null`
:   The endpoint of the connection. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if not signed up or signed in.

The possible values for connection information in each connection state are as follows:

| state | endpoint | namespace      | database       | token          |
| ----- | -------- | -------------- | -------------- | -------------- |
| `0`   | `URL`    | `null`         | `null`         | `null`         |
| `1`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `2`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `3`   | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: 0 | 1 | 2 | 3
```

Each number indicates the following meaning:

- `0` ... Connecting.
- `1` ... Connected.
- `2` ... Disconnecting.
- `3` ... Disconnected.

For convenience, it is `3` even if the connection is not established (`undefined` is not used.)

Related: Refer to [`.getConnectionInfo()`](#getconnectioninfo) as well.

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint of the connection. It is `null` only in the disconnected state. It is `undefined` if the connection is not established.

```ts
endpoint: string | null | undefined
```

Related: Refer to [`.getConnectionInfo()`](#getconnectioninfo) as well.

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if the connection is not established.

```ts
namespace: string | null | undefined
```

Related: Refer to [`.getConnectionInfo()`](#getconnectioninfo) as well.

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if the connection is not established.

```ts
database: string | null | undefined
```

Related: Refer to [`.getConnectionInfo()`](#getconnectioninfo) as well.

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if not signed up or signed in. It is `undefined` if the connection is not established.

```ts
token: string | null | undefined
```

Related: Refer to [`.getConnectionInfo()`](#getconnectioninfo) as well.

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`0 | 1 | 2 | 3`
:   The event that occurs when the connection information transitions, or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when an RPC response occurs in bidirectional communication. It is currently used only for the WebSocket protocol, and this event is not used for the HTTP protocol. `RpcMethod` is the PRC method name, such as `ping` or `use`. `number` is an identifier for associating requests/responses in bidirectional communication, and it takes an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when an event from a live query is received. It is currently used only for the WebSocket protocol, and this event is not used for the HTTP protocol. `string` is the UUID of the live query.

`error`
:   The error event. It is currently used only for the WebSocket protocol, and this event is not used for the HTTP protocol.

##### `listener`

A function that is executed when the event occurs. Refer to [Task Emitter](/en/reference/utils/task-emitter#on) as well. The values passed to `eventArgs` vary depending on the event.

`0 | 1 | 2 | 3`
:   One of the following:
:   - `{ state: 0 | 1 | 2 | 3 }`
    - `{ state: 0 | 1 | 2 | 3, error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Differential acquisition mode live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Returns

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but captures the event only once.

```ts
once(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Task listener options. Refer to [Task Emitter](/en/reference/utils/task-emitter#once).

#### Returns

Returns a `StatefulPromise` that resolves with the `eventArgs` of the `.on()` task listener.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to remove the event listener from.

##### `listener`

The event listener to remove.

#### Returns

None.
