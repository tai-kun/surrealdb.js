---
title: encode
slug: en/v1/reference/cbor/encode
---

The `encode` function encodes a JavaScript value into a `Uint8Array` in CBOR format.

### Import

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Arguments

##### `value`

The JavaScript value to be encoded into a `Uint8Array` in CBOR format. The following JavaScript values can be passed as `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set`
- Plain objects or `Map`
- `Uint8Array`
- `Simple` objects
- Values replaceable by the optional `replacer`

If the value is not a primitive and has a `toCBOR` property which is a function, it is called preferentially.

##### `options`

Encoding options.

`replacer?: Replacer | Replacer[]`
:   The encoder encodes most values into CBOR by default, but some special values might not be encodable. This option allows you to replace those values with encodable ones. This option can be set to a function or an array of functions to implement the replacement logic. If the function returns the `CONTINUE` symbol obtained from `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, the subsequent functions will be called. If no replacement can be performed, a `SurrealTypeError` will be thrown.

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
:   This option is a function that verifies if a key in a `Map` object is safe. The function takes two arguments: `key` and `map`. `key` is the value of the key, and `map` is the `Map` object being validated. If the function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, it considers `"__proto__"` or `"constructor"` as unsafe keys. Note that setting this option completely overrides the default validation. If you want to add your own validations to the default ones, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
:   This option is a function that verifies if a key in a plain object is safe. The function takes two arguments: `key` and `obj`. `key` is the value of the key, and `obj` is the plain object being validated. If the function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, it considers `"__proto__"` or `"constructor"` as unsafe keys. Note that setting this option completely overrides the default validation. If you want to add your own validations to the default ones, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of objects. The depth increases by 1 every time an object or an array is entered. The default value is `64`. There is no limit to the depth because the encoding does not use recursion, but it is recommended to keep it as small as possible.

#### Returns

A `Uint8Array` containing the encoded CBOR representation of the JavaScript value.

### Examples

#### Protecting object keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting maximum depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
