---
title: decode
slug: en/v2/api/cbor/decode
---

## Synchronous Decoding

`decode` is a function that decodes a `Uint8Array` in CBOR format into a JavaScript value.

### Import

```ts
import { decode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function decode(input: Uint8Array, options?: DecodeOptions): unknown;
```

#### Arguments

##### `input`

A `Uint8Array` in CBOR format to decode into a JavaScript value.

##### `options`

Decoding options.

`mapType?: "Object" | "Map"`
:   This option is used to select whether to decode a key-value object as a JavaScript plain object or a `Map`. Selecting `"Object"` decodes the key-value object as a plain object, and `"Map"` decodes the key-value object as an instance of the `Map` class. The default value is `"Object"`. Plain object keys can only accept strings or numbers (i.e., `string | number`), but if you decode with this option set to `"Map"`, the keys can accept all decoded values.

`reviver?: Reviver | ReviverObject | (Reviver | ReviverObject)[]`
:   This option is used to convert simple data items or tagged data items in CBOR to JavaScript values. Simple data items are limited to values between 0 and 19 and between 32 and 255. The tag of a tagged data item is a `number` or `bigint` between 0 and 2^64-1. If the function returns the `CONTINUE` symbol obtained with `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, subsequent functions will be called. A `SurrealTypeError` will be thrown if the conversion fails.

`isSafeMapKey?: (key: unknown, map: Map<unknown, unknown>) => boolean`
:   This option is a function that verifies whether the key of a `Map` object is safe. The function takes two arguments: `key` and `map`. `key` is the value of the key, and `map` is the `Map` object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that if you specify this option, the default verification will be completely overwritten. If you want to add your own verification to the default verification, you should still consider `"__proto__"` or `"constructor"` to be unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: Record<string | number, unknown>) => boolean`
:   This option is a function that verifies whether the key of a plain object is safe. The function takes two arguments: `key` and `obj`. `key` is the value of the key, and `obj` is the plain object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that if you specify this option, the default verification will be completely overwritten. If you want to add your own verification to the default verification, you should still consider `"__proto__"` or `"constructor"` to be unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of objects. The depth increases by 1 every time you enter an object or array. The default value is `64`. Although the decoding does not use recursion, there is no upper limit on the depth, but it is recommended not to make it too large.

#### Return Value

A JavaScript value decoded from a `Uint8Array` in CBOR format.

### Example

#### Decoding with `Map` object

```ts
import { decode } from "@tai-kun/surrealdb/cbor";

const cbor = new Uint8Array([
  0xa1, // mt: 5, ai: 1
  // key
  0x00, // mt: 0, ai: 0
  // value
  0x00, // mt: 0, ai: 0
]);

const value = decode(bytes, { mapType: "Map" });

console.log(value); // Map(1) { [ 0 ] => 0 }
```

## Asynchronous Decoding

`decodeStream` is a function that decodes a `Uint8Array` in CBOR format into a JavaScript value.

### Import

```ts
import { decodeStream } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function decodeStream(
  input: ReadableStream<Uint8Array>,
  options?: DecodeStreamOptions,
): unknown;
```

#### Arguments

##### `input`

A readable stream of `Uint8Array`. The Fetch API may provide this stream to the `body` property of a `Response` object for a request.

##### `options`

In addition to the options for synchronous decoding, the following options can be specified:

`signal?: AbortSignal`
:   An abort signal for interrupting the stream.

#### Return Value

A `StatefulPromise` that resolves to a JavaScript value.

### Example

#### Fetch API

```ts
import { decodeStream } from "@tai-kun/surrealdb/cbor";

const response = await fetch("http://localhost:8000/rpc", {
  method: "POST",
  headers: {
    Accept: "application/cbor",
    // ... more headers
  },
  // ... more properties
})

const result = await decodeStream(resp.body);
```
