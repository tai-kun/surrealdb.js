---
title: Encode
slug: en/v2/api/cbor/encode
---

The `encode` function encodes a JavaScript value into a `Uint8Array` in CBOR format.

### Import

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Arguments

##### `value`

A JavaScript value to be encoded into a `Uint8Array` in CBOR format. The following JavaScript values can be passed to `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set`s
- Plain objects or `Map`s
- `Uint8Array`s
- `Simple` objects
- Values that can be replaced by an optional `replacer`

If the value is not a primitive and has a `toCBOR` property that is a function, it will be called preferentially.

##### `options`

Encoding options.

`replacer?: Replacer | Replacer[]`
:   The encoder encodes most values into CBOR by default, but you can replace special values that do not fit into this scheme with encodable values. This option allows you to implement replacement logic by specifying a function or an array of functions. If the function returns the `CONTINUE` symbol, which can be obtained with `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, subsequent functions are called. If no replacement is possible, a `SurrealTypeError` is thrown.

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
:   This option is a function that validates whether the key of a `Map` object is safe. The function takes two arguments: `key` and `map`. `key` is the value of the key and `map` is the `Map` object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
:   This option is a function that validates whether the key of a plain object is safe. The function takes two arguments: `key` and `obj`. `key` is the value of the key and `obj` is the plain object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of the object. The depth increases by 1 every time you enter an object or array. The default value is `64`. Since the encoding does not use recursion, there is no upper limit on the depth, but it is recommended to keep it relatively small.

#### Return Value

A `Uint8Array` with the JavaScript value encoded in CBOR format.

### Examples

#### Protecting object keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting the maximum depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
