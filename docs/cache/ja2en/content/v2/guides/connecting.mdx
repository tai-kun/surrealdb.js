---
title: Connection
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called with `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method runs asynchronously. Within the same instance, it won't run concurrently with other `.connect()` or `.disconnect()` calls.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path doesn't end with `/rpc`, it's automatically added. So, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Connection options.

`signal?: AbortSignal`
:   An AbortSignal to abort the connection. By default, an AbortSignal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

You can't connect to a different endpoint without disconnecting with `.disconnect()`. The connection to the first established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

The following example will also fail to connect because `.connect()` doesn't run concurrently in an asynchronous context. The error message may differ each time because it's generally unknown which endpoint will establish the connection first:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.disconnect()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from the SurrealDB instance. It doesn't throw an error if not yet connected or already disconnected. This method runs asynchronously. Within the same instance, it won't run concurrently with `.connect()` or other `.disconnect()` calls.

```ts
disconnect(options?: ClientDisconnectOptions): Promise<void>
```

#### Arguments

##### `options`

Disconnection options.

`force?: boolean`
:   If set to `true`, sends an abort signal to the AbortSignal passed to event listeners of the `Surreal` object. Event listeners are expected to be interrupted immediately, even if processing is incomplete.

`signal?: AbortSignal`
:   An AbortSignal to interrupt the disconnection. By default, an AbortSignal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.disconnect();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves connection information. The connection information always holds a copy of the internal information. Therefore, even if the `URL` object included in the connection information is directly modified, the endpoint information held internally by the `Surreal` object remains unchanged. It's `undefined` if a connection has not yet been requested.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns connection information if a connection is established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   A numeric value indicating the current connection state. Each numeric value has the following meaning:

`endpoint: URL | null`
:   The endpoint to connect to. It's `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It's `null` if no namespace is selected.

`database: string | null`
:   The name of the currently selected database. It's `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It's `null` if not signed up or signed in.

The table below shows the possible values for connection information in each connection state:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A numeric value that indicates the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it's `"closed"` even if a connection hasn't been established (not `undefined`).

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to connect to. It's `null` only in the disconnected state. It's `undefined` if a connection hasn't been established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It's `null` if no namespace is selected. It's `undefined` if a connection hasn't been established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The name of the currently selected database. It's `null` if no database is selected. It's `undefined` if a connection hasn't been established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It's `null` if not signed up or signed in. It's `undefined` if a connection hasn't been established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The event name to listen for.

`"connecting" | "open" | "closing" | "closed"`
:   Events that occur when the connection information transitions or fails to transition.

`rpc_${RpcMethod}_${number}`
:   Event that occurs when an RPC response occurs in bidirectional communication. Currently only used with the WebSocket protocol, this event is not used with the HTTP protocol. `RpcMethod` is the PRC method name, such as `ping` or `use`. `number` is an identifier for associating requests/responses in bidirectional communication and is an integer from 1 to 2^53-1.

`live_${string}`
:   Event that occurs when a live query event is received. Currently only used with the WebSocket protocol, this event is not used with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   Error event. Currently only used with the WebSocket protocol, this event is not used with the HTTP protocol.

##### `listener`

A function to be executed when the event is fired. See also [Task Emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Diff-based live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but only captures the event once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Task listener options. See [Task Emitter](/en/reference/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Unregisters an event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event for which to unregister the event listener.

##### `listener`

The event listener to unregister.

#### Return Value

None.
