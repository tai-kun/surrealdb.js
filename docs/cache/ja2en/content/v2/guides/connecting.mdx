---
title: Connecting
slug: en/v2/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called through `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous, but it will not run concurrently with other `.connect()` or `.close()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Connection options.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out in 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

You cannot connect to a different endpoint without disconnecting from the previous connection using `.close()`. However, the connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: An attempt was made to connect to ws://localhost:1129/rpc while ws://localhost:8000/rpc was already connected.
```

`.connect()` is not executed concurrently within the asynchronous processing context, so the following example will also fail to connect. Usually, it is uncertain which endpoint will establish the connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Closes the connection to SurrealDB. It does not throw an error if the connection is not yet established or has already been closed. This method is asynchronous, but it will not run concurrently with `.connect()` or other `.close()` calls within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Disconnection options.

`force?: boolean`
:   If set to `true`, an abort signal will be sent to the abort signal passed to the `Surreal` object's event listeners. Event listeners are expected to be interrupted immediately, even if processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out in 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol and then closes the connection:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves the connection information. The connection information always contains a copied value of the internal information. Therefore, although the connection information includes a `URL` object, directly modifying this object will not change the endpoint information stored internally by the `Surreal` object. If a connection has not yet been requested, it is `undefined`.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if a connection is established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   A numeric value indicating the current connection state. Each value represents the following meaning:

`endpoint: URL | null`
:   The endpoint to which the connection is established. It is `null` only when in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if not signed up or signed in.

The possible values of the connection information in each connection state are shown in the following table:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A numeric value indicating the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it will be `"closed"` even when a connection is not established (not `undefined`).

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to which the connection is established. It is `null` only when in the disconnected state. It is `undefined` if a connection is not established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if a connection is not established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if a connection is not established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if not signed up or signed in. It is `undefined` if a connection is not established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   Events that occur when the connection information transitions or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   An event that occurs when an RPC response is received in two-way communication. `RpcMethod` is, for example, the name of the PRC method, such as `ping` or `use`. `number` is an identifier to link request/response in two-way communication, and takes an integer from 1 to 2^53-1. It is fixed at 0 for HTTP.

`live_${string}`
:   An event that occurs when a live query event is received. Currently used only for the WebSocket protocol, and this event is not used for the HTTP protocol. `string` is the UUID of the live query.

`error`
:   An error event. Currently used only for the WebSocket protocol, and this event is not used for the HTTP protocol.

##### `listener`

A function that is executed when the event occurs. See also [Task Emitter](/v2/api/utils/task-emitter#on). The values passed to `eventArgs` vary depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Live query in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object, record: string | object }`
:   Live query in differential acquisition mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[], record: string | object }`
    - `{ action: "DELETE", result: object, record: string | object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/v2/api/errors/#httpengineerror)
    - [`WebSocketEngineError`](/v2/api/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but captures the event only once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as the `event` of `.on()`.

##### `options`

Options for the task listener. See [Task Emitter](/v2/api/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener of `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to remove the event listener from.

##### `listener`

The event listener to remove.

#### Return Value

None.
