---
title: Connection
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called with `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method executes asynchronously and prevents overlapping execution with other `.connect()` or `.close()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the URL of the SurrealDB endpoint. If the URL path does not end with `/rpc`, it will be added automatically. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for the connection.

`signal?: AbortSignal`
:   An AbortSignal to abort the connection. By default, an AbortSignal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

You cannot connect to a different endpoint without disconnecting from the currently connected endpoint using `.close()`. Note that the connection to the endpoint that was established first will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` does not execute concurrently in an asynchronous context, the following example will also fail to connect. The error message may differ each time because it is generally unknown which endpoint will establish the connection first:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from the SurrealDB instance. It will not throw an error if it is not yet connected or already disconnected. This method executes asynchronously and prevents overlapping execution with `.connect()` or other `.close()` calls within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If set to `true`, an AbortSignal is sent to the AbortSignal passed to the `Surreal` object's event listener. The event listener is expected to be aborted immediately, even if processing is incomplete.

`signal?: AbortSignal`
:   An AbortSignal to abort the disconnection process. By default, an AbortSignal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves the connection information. The connection information always holds a copy of the internal information. Therefore, although the connection information includes a `URL` object, directly modifying it will not change the endpoint information held internally by the `Surreal` object. It returns `undefined` if a connection has not yet been requested.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if the connection is established, otherwise `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   A string indicating the current connection state. Each value has the following meaning:

`endpoint: URL | null`
:   The endpoint to connect to. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if not signed up or signed in.

The following table shows the possible values of the connection information for each connection state:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A string indicating the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it will be `"closed"` even if the connection has not been established (not `undefined`).

See also: [`.getConnectionInfo()`](#getconnectioninfo)

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to connect to. It is `null` only in the disconnected state. It is `undefined` if a connection has not yet been established.

```ts
endpoint: string | null | undefined
```

See also: [`.getConnectionInfo()`](#getconnectioninfo)

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if a connection has not yet been established.

```ts
namespace: string | null | undefined
```

See also: [`.getConnectionInfo()`](#getconnectioninfo)

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if a connection has not yet been established.

```ts
database: string | null | undefined
```

See also: [`.getConnectionInfo()`](#getconnectioninfo)

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if not signed up or signed in. It is `undefined` if a connection has not yet been established.

```ts
token: string | null | undefined
```

See also: [`.getConnectionInfo()`](#getconnectioninfo)

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
on(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to listen for.

`"connecting" | "open" | "closing" | "closed"`
:   The event that occurs when the connection information transitions or fails to transition.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when an RPC response occurs in bidirectional communication. Currently, it is only used in the WebSocket protocol and not in the HTTP protocol. `RpcMethod` is the PRC method name, such as `ping` or `use`. `number` is an identifier for associating requests/responses in bidirectional communication, and is an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when a live query event is received. Currently, it is only used in the WebSocket protocol and not in the HTTP protocol. `string` is the UUID of the live query.

`error`
:   The error event. Currently, it is only used in the WebSocket protocol and not in the HTTP protocol.

##### `listener`

The function to execute when the event is fired. See also [Task Emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   For live queries in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   For live queries in diff mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but captures the event only once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Options for the task listener. See [Task Emitter](/en/reference/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Unregisters an event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the listener for.

##### `listener`

The event listener to unregister.

#### Return Value

None.
