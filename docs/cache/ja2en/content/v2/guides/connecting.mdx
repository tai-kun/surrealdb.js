---
title: Connecting
slug: en/v2/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When invoked through `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous but does not overlap with other `.connect()` or `.close()` methods within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the URL of the SurrealDB endpoint. If the end of the URL path is not `/rpc`, it is automatically added. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for connection.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

Connecting to a different endpoint without disconnecting with `.close()` is not possible. The connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` is not executed concurrently in an asynchronous processing context, the following example also fails to connect. Usually, it is unknown which endpoint establishes the connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from SurrealDB. If not yet connected or already disconnected, it will not throw an error. This method is asynchronous but does not overlap with `.connect()` or other `.close()` methods within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnection.

`force?: boolean`
:   If `true`, sends an abort signal to the abort signal passed to the `Surreal` object's event listeners. Event listeners are expected to terminate immediately even if the processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol and then disconnects:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves the connection information. The connection information always holds a value copied from internal information. Therefore, the connection information includes a `URL` object, but directly changing it will not change the endpoint information held internally by the `Surreal` object. If a connection has not been requested yet, it is `undefined`.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if the connection is established. Otherwise, it returns `undefined`. The connection information includes the following items.

`state: "connecting" | "open" | "closing" | "closed"`
:   A number indicating the current connection state. Each number represents the following meaning:

`endpoint: URL | null`
:   The endpoint to connect to. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if you are not signed up or signed in.

The possible values of the connection information for each connection state are shown in the following table:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it will be `"closed"` (not `undefined`) even if no connection is established.

Related: Also see [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to connect to. It is `null` only in the disconnected state. If no connection is established, it is `undefined`.

```ts
endpoint: string | null | undefined
```

Related: Also see [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if no connection is established.

```ts
namespace: string | null | undefined
```

Related: Also see [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if no connection is established.

```ts
database: string | null | undefined
```

Related: Also see [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if you are not signed up or signed in. It is `undefined` if no connection is established.

```ts
token: string | null | undefined
```

Related: Also see [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   The event that occurs when the connection information transitions or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when an RPC response occurs in bi-directional communication. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol. `RpcMethod` is the name of the PRC method, such as `ping` or `use`. `number` is an identifier for associating requests/responses in bi-directional communication, and takes an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when an event from a live query is received. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   The error event. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol.

##### `listener`

The function to execute when the event occurs. Also see [task emitter](/v2/api/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object, record: string | object }`
:   Incremental mode live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[], record: string | object }`
    - `{ action: "DELETE", result: object, record: string | object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/v2/api/errors/#httpengineerror)
    - [`WebSocketEngineError`](/v2/api/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but it catches the event only once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as the `event` in `.on()`.

##### `options`

Task listener options. See [task emitter](/v2/api/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Unregisters the event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the event listener for.

##### `listener`

The event listener to unregister.

#### Return Value

None.
