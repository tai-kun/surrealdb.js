---
title: Connecting
slug: en/v2/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called through `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method runs asynchronously, but it will not overlap with other `.connect()` or `.close()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for the connection.

`signal?: AbortSignal`
:   The abort signal to abort the connection. By default, an abort signal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

It is not possible to connect to a different endpoint without disconnecting with `.close()`. However, the connection with the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` will not execute simultaneously in an asynchronous processing context, the following example will also fail to connect. Usually, it is not clear which endpoint will establish a connection first, so the error message may vary each time:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from SurrealDB. It does not throw an error if it is not connected yet or is already disconnected. This method runs asynchronously, but it will not overlap with `.connect()` or other `.close()` calls within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If `true`, an abort signal is sent to the abort signal passed to the event listeners of the `Surreal` object. Event listeners are expected to abort immediately even if the processing is incomplete.

`signal?: AbortSignal`
:   The abort signal to abort the connection. By default, an abort signal that times out after 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects from it:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Gets the connection information. The connection information always holds a value that is a copy of the internal information. Therefore, the connection information includes a `URL` object, but modifying it directly will not change the endpoint information that the `Surreal` object holds internally. If no connection request has been made yet, it is `undefined`.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if a connection has been established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   A number indicating the current connection state. Each number represents the following meaning:

`endpoint: URL | null`
:   The endpoint to connect to. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if you have not signed up or signed in.

The possible values for the connection information in each connection state are shown in the following table:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, even if no connection has been established, it will be `"closed"` (not `undefined`).

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to connect to. It is `null` only in the disconnected state. It is `undefined` if no connection has been established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if no connection has been established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if no connection has been established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if you have not signed up or signed in. It is `undefined` if no connection has been established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   The event that occurs when the connection information transitions or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when a RPC response occurs in two-way communication. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol. `RpcMethod` is the name of the PRC method, such as `ping` or `use`. `number` is an identifier to link requests and responses in two-way communication, and it takes an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when an event from a live query is received. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   The error event. Currently, it is only used with the WebSocket protocol, and this event is not used with the HTTP protocol.

##### `listener`

The function to be executed when the event occurs. See also [Task Emitter](/v2/api/utils/task-emitter#on). The values passed to `eventArgs` vary depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Incremental mode live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/v2/api/errors/#httpengineerror)
    - [`WebSocketEngineError`](/v2/api/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but catches the event only once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Task listener options. See [Task Emitter](/v2/api/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the `.on()` task listener.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to remove the event listener from.

##### `listener`

The event listener to remove.

#### Return Value

None.
