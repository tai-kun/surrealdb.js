---
title: encode
---

The `encode` function encodes a JavaScript value into a CBOR-formatted `Uint8Array`.

### Import

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Signature

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Parameters

##### `value`

The JavaScript value to encode into a CBOR-formatted `Uint8Array`. The following JavaScript values can be passed to `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set` objects
- Plain objects or `Map` objects
- `Uint8Array` objects
- `Simple` objects
- Values that can be replaced by an optional `replacer`

If `toCBOR` property is a function, it is called preferentially, rather than treating the value as a primitive.

##### `options`

Encoding options.

`replacer?: Replacer | Replacer[]`
: The encoder encodes most values to CBOR by default, but you can replace special values that do not apply to encodable values. You can implement replacement processing by specifying a function or an array of functions for this option. If the function returns the `CONTINUE` symbol obtained with `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, the subsequent function is called. If nothing can be replaced, a `SurrealTypeError` is thrown. 

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
: This option is a function that validates whether the key of a `Map` object is safe. The function takes two arguments: `key` and `map`. `key` is the value of the key and `map` is the `Map` object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also determine that `"__proto__"` or `"constructor"` are unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
: This option is a function that validates whether the key of a plain object is safe. The function takes two arguments: `key` and `obj`. `key` is the value of the key and `obj` is the plain object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also determine that `"__proto__"` or `"constructor"` are unsafe keys.

`maxDepth?: number`
: Specifies the maximum depth of the object. The depth increases by 1 for each object or array entered. The default value is `64`. Since recursion is not used for encoding, there is no upper limit to the depth, but it is recommended to keep it small.

#### Return Value

A `Uint8Array` containing the CBOR-encoded JavaScript value.

### Examples

#### Protecting Object Keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing Symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting Maximum Depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
