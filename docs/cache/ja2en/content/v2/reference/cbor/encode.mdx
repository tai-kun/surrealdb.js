---
title: encode
---

The `encode` function encodes a JavaScript value into a `Uint8Array` in CBOR format.

### Importing

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Arguments

##### `value`

The JavaScript value to be encoded into a `Uint8Array` in CBOR format. The following JavaScript values can be passed to `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set`
- Plain objects or `Map`
- `Uint8Array`
- `Simple` objects
- Values that can be replaced with an optional `replacer`

If the value is not a primitive value and has a `toCBOR` property that is a function, it will be called preferentially.

##### `options`

Encoding options.

`replacer?: Replacer | Replacer[]`
:   The encoder encodes most values to CBOR by default, but some special values may not be directly encodable. This option allows you to implement a replacement process for these values using a function or an array of functions. If a function returns the `CONTINUE` symbol, obtained using `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, subsequent functions will be called. If no replacement can be found, a `SurrealTypeError` will be thrown.

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
:   This option is a function that verifies if the key of a `Map` object is safe. The function receives two arguments: `key`, the key value, and `map`, the `Map` object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, keys that are `"__proto__"` or `"constructor"` are considered unsafe. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
:   This option is a function that verifies if the key of a plain object is safe. The function receives two arguments: `key`, the key value, and `obj`, the plain object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, keys that are `"__proto__"` or `"constructor"` are considered unsafe. Note that specifying this option completely overrides the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of objects. The depth increases by 1 each time you enter an object or an array. The default value is `64`. Encoding does not use recursion, so there is no limit to the depth, but it is recommended not to set it too large.

#### Returns

A `Uint8Array` containing the encoded CBOR representation of the JavaScript value.

### Examples

#### Protecting Object Keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing Symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting Maximum Depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
