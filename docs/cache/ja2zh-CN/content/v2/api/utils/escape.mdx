---
title: escape
slug: zh-CN/v2/api/utils/escape
---

## quoteStr

`quoteStr` 函数用于将字符串用引号括起来。为了方便起见，即使是空字符串也会被用引号括起来。

### 导入

```ts
import { quoteStr } from "@tai-kun/surrealdb/utils";
```

### 使用方法

```ts
function quoteStr(str: string): string;
```

该函数会用引号（`"` 或 `'`) 括起字符串。

#### 参数

##### `str`

要括起来的字符串。

#### 返回值

函数会返回用引号括起来的字符串。使用的引号类型取决于给定字符串中是否包含单引号 (`'`)：

- 如果给定字符串为空
  - 函数会返回 `''`。
- 如果给定字符串**不包含**单引号
  - 函数会用单引号括起来。
- 如果给定字符串**包含**单引号
  - 函数会用双引号括起来。
- 如果给定字符串同时包含单引号和双引号
  - 函数会用双引号括起来。
  - 双引号会使用反斜杠 (`\`) 进行转义。

#### 例子

以下示例展示了将**不包含**单引号的字符串用单引号括起来：

```ts
import { quoteStr } from "@tai-kun/surrealdb/utils";

console.log(quoteStr(``));
console.log(quoteStr(`a`));
console.log(quoteStr(`𩸽`));
console.log(quoteStr(`👍🏽`));
console.log(quoteStr(`パ`));
```

输出：

```js
''
'a'
'𩸽'
'👍🏽'
'パ'
```

以下示例展示了将**包含**单引号的字符串用双引号括起来：

```ts
import { quoteStr } from "@tai-kun/surrealdb/utils";

console.log(quoteStr(`cat's`));
console.log(quoteStr(`𩸽's`));
console.log(quoteStr(`'👍🏽`));
console.log(quoteStr(`'パ`));
```

输出：

```js
"cat's"
"𩸽's"
"'👍🏽"
"'パ"
```

以下示例展示了将同时包含单引号和双引号的字符串用双引号括起来，并在必要时进行转义：

```ts
import { quoteStr } from "@tai-kun/surrealdb/utils";

console.log(quoteStr(`cat's "toy"`));
console.log(quoteStr(`'\\"\\`));
console.log(quoteStr(`𩸽's "feed"`));
console.log(quoteStr(`'👍🏽"`));
console.log(quoteStr(`'パ"`));
```

输出：

```js
"cat's \"toy\""
"'\\\"\\"
"𩸽's \"feed\""
"'👍🏽\""
"'パ\""
```

## escapeKey

`escapeKey` 函数与 [`quoteStr`](/v2/api/utils/quote-str/) 类似，但用于处理对象的键。为了方便起见，即使是空字符串也会被用引号括起来。

### 导入

```ts
import { escapeKey } from "@tai-kun/surrealdb/utils";
```

### 使用方法

```ts
function escapeKey(key: string): string;
```

#### 参数

##### `key`

对象的键。

#### 返回值

函数会返回转义后的字符串。如果需要，会用双引号括起来：

- 如果给定字符串为空
  - 函数会返回 `""`。
- 如果给定字符串不以数字开头，并且只包含字母数字字符和下划线
  - 函数会直接返回该字符串。
- 如果给定字符串包含双引号
  - 函数会对其进行转义。
- 如果给定字符串包含反斜杠 (`\`)
  - 函数会对其进行转义。
- 如果给定字符串以数字开头，或者包含字母数字字符和下划线以外的字符
  - 函数会用双引号括起来。

#### 例子

以下示例展示了如果字符串只包含字母数字字符和下划线，函数会直接返回该字符串：

```ts
import { escapeKey } from "@tai-kun/surrealdb/utils";

console.log(escapeKey(`foo_bar`));
```

输出：

```js
foo_bar
```

以下示例展示了如果字符串需要转义或用双引号括起来，函数会对其进行处理：

```ts
import { escapeKey } from "@tai-kun/surrealdb/utils";

console.log(escapeKey(``));
console.log(escapeKey(`123`));
console.log(escapeKey(`foo-bar`));
console.log(escapeKey(`'\\"\\`));
console.log(escapeKey(`𩸽's "feed"`));
console.log(escapeKey(`'👍🏽"`));
console.log(escapeKey(`'パ"`));
```

输出：

```js
""
"123"
"foo-bar"
"'\\"\"
"𩸽's \"feed\""
"'👍🏽\""
"'パ\""
```

## escapeRid

`escapeRid` 函数与 [`quoteStr`](/v2/api/utils/quote-str/) 类似，但用于处理记录 ID。为了方便起见，即使是空字符串也会被用引号括起来。

### 导入

```ts
import { escapeRid } from "@tai-kun/surrealdb/utils";
```

### 使用方法

```ts
function escapeRid(rid: string): string;
```

#### 参数

##### `rid`

记录 ID 的 ID 部分。

#### 返回值

函数会返回转义后的字符串。如果需要，会用尖括号 (`⟨⟩`) 括起来：

- 如果给定字符串为空
  - 函数会返回 `⟨⟩`。
- 如果给定字符串不以数字开头，并且只包含字母数字字符和下划线
  - 函数会直接返回该字符串。
- 如果给定字符串包含尖括号 (`⟩`)
  - 函数会对其进行转义。
- 如果给定字符串完全由数字组成，或者包含字母数字字符和下划线以外的字符
  - 函数会用尖括号 (`⟨⟩`) 括起来。

#### 例子

以下示例展示了如果字符串不以数字开头，并且只包含字母数字字符和下划线，函数会直接返回该字符串：

```ts
import { escapeRid } from "@tai-kun/surrealdb/utils";

console.log(escapeRid(`foo_123`));
```

输出：

```js
foo_123
```

以下示例展示了如果字符串需要转义或用尖括号 (`⟨⟩`) 括起来，函数会对其进行处理：

```ts
import { escapeRid } from "@tai-kun/surrealdb/utils";

console.log(escapeRid(``));
console.log(escapeRid(`123`));
console.log(escapeRid(`foo-bar`));
console.log(escapeRid(`𩸽's ⟨feed⟩`));
console.log(escapeRid(`'👍🏽⟩`));
console.log(escapeRid(`'パ⟩`));
```

输出：

```js
⟨⟩
⟨123⟩
⟨foo-bar⟩
⟨𩸽's ⟨feed\⟩⟩
⟨'👍🏽\⟩⟩
⟨'パ\⟩⟩
```

## escapeIdent

`escapeIdent` 函数与 [`quoteStr`](/v2/api/utils/quote-str/) 类似，但用于处理命名空间、数据库、表和字段的名称。为了方便起见，即使是空字符串也会被用引号括起来。

### 导入

```ts
import { escapeIdent } from "@tai-kun/surrealdb/utils";
```

### 使用方法

```ts
function escapeIdent(ident: string): string;
```

#### 参数

##### `ident`

标识符。

#### 返回值

函数会返回转义后的字符串。如果需要，会用反引号 (<code>`</code>) 括起来：

- 如果给定字符串为空
  - 函数会返回 <code>``</code>。{/* TODO(tai-kun): " になる問題解決する */}
- 如果给定字符串不以数字开头，并且只包含字母数字字符和下划线
  - 函数会直接返回该字符串。
- 如果给定字符串包含反引号 (<code>`</code>)
  - 函数会对其进行转义。
- 如果给定字符串以数字开头，或者包含字母数字字符和下划线以外的字符
  - 函数会用反引号 (<code>`</code>) 括起来。

#### 例子

以下示例展示了如果字符串不以数字开头，并且只包含字母数字字符和下划线，函数会直接返回该字符串：

```ts
import { escapeIdent } from "@tai-kun/surrealdb/utils";

console.log(escapeIdent(`foo_123`));
```

输出：

```js
foo_123
```

以下示例展示了如果字符串需要转义或用反引号 (<code>`</code>) 括起来，函数会对其进行处理：

```ts
import { escapeIdent } from "@tai-kun/surrealdb/utils";

console.log(escapeIdent(""));
console.log(escapeIdent("123"));
console.log(escapeIdent("foo-bar"));
console.log(escapeIdent("𩸽's `feed`"));
console.log(escapeIdent("'👍🏽`"));
console.log(escapeIdent("'パ`"));
```

输出：

```js
``
`123`
`foo-bar`
`𩸽's \`feed\``
`'👍🏽\``
`'パ\``
```

## 补充说明

### 字符串长度

前面的示例中使用的字符串包含一些字符，其在 JavaScript 中的字符串长度和人类感知的字符串长度不同：

| 类型 | 显示 | `.length` | `Uint8Array` |
| --- | --- | --- | --- |
| ASCII | a | 1 | `[ 0x61 ]` |
| 代理对 | 𩸽 | 2 | `[ 0xF0, 0xA9, 0xB8, 0xBD ]` |
| 变体选择器 | 👍🏽 | 4 | `[ 0xF0, 0x9F, 0x91, 0x8D, 0xF0, 0x9F, 0x8F, 0xBD ]` |
| 组合字符 | パ | 2 | `[ 0xE3, 0x83, 0x8F, 0xE3, 0x82, 0x9A ]` |

当 `.length` 的值与直觉不符时，需要谨慎地处理字符串操作。
