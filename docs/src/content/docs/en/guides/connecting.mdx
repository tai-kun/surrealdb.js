---
title: Connection
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Returns

When called with `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method executes asynchronously but does not overlap with other `.connect()` or `.disconnect()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

The URL of the SurrealDB endpoint. If the URL path does not end with `/rpc`, it is added automatically. So, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for the connection.

`signal?: AbortSignal`
:   An AbortSignal to abort the connection. By default, an AbortSignal that times out after 15 seconds is set.

#### Returns

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

You cannot connect to a different endpoint without disconnecting from the previously established connection using `.disconnect()`. The connection to the first endpoint to be successfully connected will remain active:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

The following example will also fail to connect because `.connect()` calls are not executed concurrently within an asynchronous context. The error message may differ each time because it's generally unknown which endpoint establishes a connection first:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.disconnect()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from the SurrealDB instance. This method does not throw an error if the client is not connected or is already disconnected. This method executes asynchronously but does not overlap with `.connect()` or other `.disconnect()` calls within the same instance.

```ts
disconnect(options?: ClientDisconnectOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If set to `true`, an AbortSignal will be sent to the AbortSignal passed to the event listeners of the `Surreal` object. Event listeners are expected to be interrupted immediately even if processing is incomplete.

`signal?: AbortSignal`
:   An AbortSignal to abort the connection. By default, an AbortSignal that times out after 15 seconds is set.

#### Returns

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.disconnect();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Gets the connection information. The connection information always has a value that is a copy of the internal information. Therefore, although the connection information contains a `URL` object, changing it directly does not change the endpoint information held internally by the `Surreal` object. It is `undefined` if a connection has not yet been requested.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Returns

Returns the connection information if the connection is established; otherwise, `undefined`. The connection information contains the following items:

`state: 0 | 1 | 2 | 3`
:   A number indicating the current connection state. Each number has the following meaning:
:   - `0` ... Connecting.
    - `1` ... Connected.
    - `2` ... Disconnecting.
    - `3` ... Disconnected.

`endpoint: URL | null`
:   The endpoint to connect to. `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. `null` if not signed up or signed in.

The possible values for connection information in each connection state are shown in the following table:

| state | endpoint | namespace      | database       | token          |
| ----- | -------- | -------------- | -------------- | -------------- |
| `0`   | `URL`    | `null`         | `null`         | `null`         |
| `1`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `2`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `3`   | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: 0 | 1 | 2 | 3
```

Each number has the following meaning:

- `0` ... Connecting.
- `1` ... Connected.
- `2` ... Disconnecting.
- `3` ... Disconnected.

For convenience, it is `3` even if the connection is not established (not `undefined`.)

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to connect to. `null` only in the disconnected state. `undefined` if a connection has not yet been established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. `null` if no namespace is selected. `undefined` if a connection has not yet been established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. `null` if no database is selected. `undefined` if a connection has not yet been established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. `null` if not signed up or signed in. `undefined` if a connection has not yet been established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
on(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to listen for.

`0 | 1 | 2 | 3`
:   The event that is fired when the connection information transitions or fails to transition.

`rpc_${RpcMethod}_${number}`
:   The event that is fired when an RPC response is received in bidirectional communication. Currently, this event is only used for WebSocket protocol and not for HTTP protocol. `RpcMethod` is an RPC method name such as `ping` or `use`. `number` is an identifier for associating requests/responses in bidirectional communication and is an integer from 1 to 2^53-1.

`live_${string}`
:   The event that is fired when a live query event is received. Currently, this event is only used for WebSocket protocol and not for HTTP protocol. `string` is the UUID of the live query.

`error`
:   An error event. Currently, this event is only used for WebSocket protocol and not for HTTP protocol.

##### `listener`

A function that is executed when the event is fired. See also [Task Emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`0 | 1 | 2 | 3`
:   One of the following:
:   - `{ state: 0 | 1 | 2 | 3 }`
    - `{ state: 0 | 1 | 2 | 3, error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   For live queries in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   For live queries in diff mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Returns

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but captures the event only once.

```ts
once(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Options for the task listener. See [Task Emitter](/en/reference/utils/task-emitter#once).

#### Returns

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Unregisters an event listener registered with `.on()`.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the listener for.

##### `listener`

The event listener to unregister.

#### Returns

None.
