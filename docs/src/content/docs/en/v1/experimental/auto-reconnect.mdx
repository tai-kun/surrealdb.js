---
title: Auto Reconnect
slug: en/v1/experimental/auto-reconnect
banner:
  content: This is an experimental feature and the API is subject to change.
---

This feature provides automatic reconnection attempts in response to connection interruptions that occur in real-time communication using technologies such as WebSockets. It performs reconnections based on a specific logic and emits events for both successful and unsuccessful attempts.

The `autoReconnect` function creates an instance of the `AutoReconnect` class, allowing you to utilize the reconnection functionality.

### Importing

```ts
import { autoReconnect } from "@tai-kun/surrealdb";
```

### Syntax

```ts
function autoReconnect(
  db: Client, 
  options?: AutoReconnectOptions
): AutoReconnect;
```

#### Arguments

##### `db`

An instance object of the `Surreal` class.

##### `options`

Options for specifying reconnection settings. You can configure the reconnection interval, maximum delay time, reconnection conditions, etc. These can be omitted if you wish to use the default settings.

`backoffLimit?: number`
:   Specifies the maximum number of times to attempt reconnection. The default value is `Infinity`.

`initialDelay?: number`
:   The delay time (in milliseconds) before the first reconnection attempt is made. The default value is `500`.

`maxDelay?: number`
:   The maximum value (in milliseconds) for reconnection delay time. The delay increases as the backoff progresses, but this value serves as the upper limit. The default value is `30_000` (30 seconds).

`shouldReconnect?: { ping?: { threshold: number; perMillis: number }} | (error) => boolean`
:   Specifies the condition for performing reconnection. If specified as a function, it determines whether or not to reconnect based on the arguments of the error event.

#### Return Value

Returns an instance of the `AutoReconnect` class. This instance can be used for controlling reconnections, retrieving status information, and monitoring events.

`.getReconnectionInfo(): ReconnectionInfo`
:   Retrieves the current reconnection information (`.state` and `.phase`). These properties represent the following:
:   `.state`:
    - `"waiting"` ... Initial state. No reconnection attempts have been made.
    - `"running"` ... Currently attempting reconnection.
    - `"success"` ... Reconnection successful.
    - `"failure"` ... Reconnection failed.
:   `.phase`:
    - `"waiting"`       ... Initial state. No reconnection attempts have been made.
    - `"pending"`       ... Reconnection requested and waiting for a certain duration before execution.
    - `"disconnecting"` ... Disconnecting.
    - `"connecting"`    ... Connecting. Attempts to connect even if the disconnect fails.
    - `"succeeded"`     ... Reconnection successful.
    - `"failed"`        ... Reconnection failed.

| state       | phase                           |
| ----------- | ------------------------------- |
| `"waiting"` | `"waiting"\|"pending"`          |
| `"running"` | `"disconnecting"\|"connecting"` |
| `"success"` | `"pending"\|"succeeded"`        |
| `"failure"` | `"pending"\|"failed"`           |

`.enable(): void`
:   Enables the reconnection feature. When this method is called, reconnections will be attempted. Enabled by default.

`.disable(): void`
:   Disables the reconnection feature. When this method is called, reconnections will be disabled.

`.reset(): void`
:   Resets the reconnection counter. This initializes the backoff logic for reconnections.

`.enabled: boolean`
:   A boolean value indicating whether the reconnection feature is enabled or not. If `true`, reconnections are enabled.

### Example

```ts
import { autoReconnect, Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
const ar = autoReconnect(db, {
  initialDelay: 1000,
  maxDelay: 30000,
  backoffLimit: 5,
  shouldReconnect: {
    ping: {
      perMillis: 60000, // Within 1 minute,
      threshold: 3,     // If 3 or more ping failures occur, reconnect.
    },
  },
});

ar.on("pending", (endpoint, duration) => {
  console.log(`${duration / 1000} seconds later, reconnecting to ${endpoint}...`);
});

ar.on("success", (endpoint) => {
  console.log(`Reconnection to ${endpoint} successful ðŸŽ‰`);
});

ar.on("failure", (endpoint, cause) => {
  console.error(`Reconnection to ${endpoint} failed ðŸ¤¯`);
  console.error("Cause:", cause);
});

try {
  await db.connect("ws://127.0.0.1:8000");

  // Various processes that run over long periods

} finally {
  await db.disconnect();
}
```

### Notes

- The reconnection logic is crucial for ensuring stability and proper recovery frequency for WebSocket connections. Option configurations should be adjusted based on system requirements and use cases.
- `autoReconnect` is intended to attempt recovery when connections are lost, and it does not guarantee complete recovery in all cases.
