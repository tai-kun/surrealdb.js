---
title: Connection
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called through `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to a SurrealDB endpoint. This method is asynchronous, but it will not execute concurrently with other `.connect()` or `.disconnect()` within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it is automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Connection options.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal is set to timeout in 15 seconds.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

Connecting to a different endpoint without disconnecting with `.disconnect()` is not possible. However, the connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` is not executed concurrently in the asynchronous processing context, the following example also fails to connect. Normally, it is unclear which endpoint establishes the connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.disconnect()` <Badge variant="instance" /><Badge variant="method" />

Disconnects the connection to SurrealDB. It does not throw an error if it is not yet connected or already disconnected. This method is asynchronous, but it will not execute concurrently with `.connect()` or other `.disconnect()` within the same instance.

```ts
disconnect(options?: ClientDisconnectOptions): Promise<void>
```

#### Arguments

##### `options`

Disconnection options.

`force?: boolean`
:   If `true`, it sends an abort signal to the abort signal passed to the event listeners of the `Surreal` object. Event listeners are expected to be immediately interrupted even if the processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal is set to timeout in 15 seconds.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects it:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.disconnect();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves connection information. Connection information always contains a value copied from internal information. Therefore, connection information includes a `URL` object, but changing it directly will not change the endpoint information held internally by the `Surreal` object. It is `undefined` if the connection has not been requested yet.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns connection information if a connection is established. Otherwise, returns `undefined`. Connection information includes the following items:

`state: 0 | 1 | 2 | 3`
:   A number indicating the current connection state. Each number represents the following:
:   - `0` ... Connecting.
    - `1` ... Connected.
    - `2` ... Disconnecting.
    - `3` ... Disconnected.

`endpoint: URL | null`
:   The endpoint being connected to. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if not signed up or signed in.

The possible values of connection information in each connection state are as follows:

| state | endpoint | namespace      | database       | token          |
| ----- | -------- | -------------- | -------------- | -------------- |
| `0`   | `URL`    | `null`         | `null`         | `null`         |
| `1`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `2`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `3`   | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: 0 | 1 | 2 | 3
```

Each number represents the following:

- `0` ... Connecting.
- `1` ... Connected.
- `2` ... Disconnecting.
- `3` ... Disconnected.

For convenience, it is `3` even if the connection is not established (`undefined` is not used).

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint being connected to. It is `null` only in the disconnected state. It is `undefined` if the connection is not established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if the connection is not established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if the connection is not established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if not signed up or signed in. It is `undefined` if the connection is not established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`0 | 1 | 2 | 3`
:   Event that occurs when the connection information transitions or fails to transition.

`rpc_${RpcMethod}_${number}`
:   Event that occurs when an RPC response occurs in bidirectional communication. Currently only used for WebSocket protocols, and this event is not used for HTTP protocols. `RpcMethod` is the RPC method name, such as `ping` or `use`. `number` is an identifier for associating requests/responses in bidirectional communication and takes an integer from 1 to 2^53-1.

`live_${string}`
:   Event that occurs when a live query event is received. Currently only used for WebSocket protocols, and this event is not used for HTTP protocols. `string` is the live query UUID.

`error`
:   Error event. Currently only used for WebSocket protocols, and this event is not used for HTTP protocols.

##### `listener`

A function to be executed when the event occurs. See also [task emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`0 | 1 | 2 | 3`
:   One of the following:
:   - `{ state: 0 | 1 | 2 | 3 }`
    - `{ state: 0 | 1 | 2 | 3, error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Live query in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Live query in differential mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but catches the event only once.

```ts
once(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Task listener options. See [task emitter](/en/reference/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that is resolved by `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Unregisters the event listener registered with `.on()`.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the event listener for.

##### `listener`

The event listener to unregister.

#### Return Value

None.
