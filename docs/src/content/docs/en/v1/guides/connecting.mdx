---
title: Connecting
slug: en/v1/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called via `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous, but it will not be executed concurrently with other `.connect()` or `.disconnect()` within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be added automatically. Therefore, if you pass `http://localhost:8000` as an argument, it will connect to `http://localhost:8000/rpc`.

##### `options`

Options for connecting.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out in 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

You cannot connect to a different endpoint without disconnecting using `.disconnect()`. However, the connection to the endpoint that was established first will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` is not executed concurrently in the context of asynchronous processing, the following example also fails to connect. Normally, since it is not clear which endpoint will establish the connection first, the error message may vary each time:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.disconnect()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from SurrealDB. It will not throw an error if it is not already connected or if it has already been disconnected. This method is asynchronous, but it will not be executed concurrently with `.connect()` or other `.disconnect()` within the same instance.

```ts
disconnect(options?: ClientDisconnectOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If `true`, it will send an abort signal to the abort signal passed to the event listener of the `Surreal` object. The event listener is expected to abort immediately, even if the processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal that times out in 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves with `undefined`.

#### Examples

The following example connects to SurrealDB using the WebSocket protocol and then disconnects the connection:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.disconnect();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Gets the connection information. Connection information always has a value that is a copy of the internal information. Therefore, the connection information contains a `URL` object, but even if you directly modify it, the endpoint information held internally by the `Surreal` object will not change. It is `undefined` if no connection has been requested yet.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if a connection is established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: 0 | 1 | 2 | 3`
:   A number indicating the current connection state. Each number indicates the following:
:   - `0` ... Connecting.
    - `1` ... Connected.
    - `2` ... Disconnecting.
    - `3` ... Disconnected.

`endpoint: URL | null`
:   The endpoint to which you are connected. It is `null` only when disconnected.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if you are not signed up or signed in.

The possible values of the connection information for each connection state are shown in the table below:

| state | endpoint | namespace      | database       | token          |
| ----- | -------- | -------------- | -------------- | -------------- |
| `0`   | `URL`    | `null`         | `null`         | `null`         |
| `1`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `2`   | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `3`   | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A number indicating the current connection state.

```ts
state: 0 | 1 | 2 | 3
```

Each number indicates the following:

- `0` ... Connecting.
- `1` ... Connected.
- `2` ... Disconnecting.
- `3` ... Disconnected.

For convenience, even if no connection is established, it will be `3` (not `undefined`).

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to which you are connected. It is `null` only when disconnected. It is `undefined` if no connection is established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. It is `undefined` if no connection is established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. It is `undefined` if no connection is established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if you are not signed up or signed in. It is `undefined` if no connection is established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`0 | 1 | 2 | 3`
:   The event that occurs when the connection information transitions, or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when an RPC response occurs in two-way communication. Currently used only with the WebSocket protocol, this event is not used with the HTTP protocol. `RpcMethod` is the name of the PRC method such as `ping` or `use`. `number` is an identifier used to link requests and responses in two-way communication and is an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when an event of a live query is received. Currently used only with the WebSocket protocol, this event is not used with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   Error event. Currently used only with the WebSocket protocol, this event is not used with the HTTP protocol.

##### `listener`

The function to be executed when the event occurs. See also [Task Emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`0 | 1 | 2 | 3`
:   One of the following:
:   - `{ state: 0 | 1 | 2 | 3 }`
    - `{ state: 0 | 1 | 2 | 3, error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Incremental mode live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but it catches the event only once.

```ts
once(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as the `event` in `.on()`.

##### `options`

Task listener options. See [Task Emitter](/en/reference/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | 0 | 1 | 2 | 3
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the event listener for.

##### `listener`

The event listener to unregister.

#### Return Value

None.
