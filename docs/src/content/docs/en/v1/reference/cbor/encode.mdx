---
title: encode
slug: en/v1/reference/cbor/encode
---

The `encode` function converts a JavaScript value to a CBOR-formatted `Uint8Array`.

### Import

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Arguments

##### `value`

The JavaScript value to be encoded into a CBOR-formatted `Uint8Array`. The following JavaScript values can be passed to `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set`s
- Plain objects or `Map`s
- `Uint8Array`s
- `Simple` objects
- Values that can be replaced with an optional `replacer`

If the value is not a primitive and has a `toCBOR` property that is a function, it will be called first.

##### `options`

The encoding options.

`replacer?: Replacer | Replacer[]`
:   The encoder encodes most values to CBOR by default, but some special values may not be encodable. This option allows you to replace these values with encodable ones. This option can be implemented by passing a function or an array of functions. If the function returns the `CONTINUE` symbol which is available with `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, subsequent functions will be called. If no replacement is found, a `SurrealTypeError` will be thrown.

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
:   This option is a function that validates whether the keys of `Map` objects are safe. The function receives two arguments: `key` and `map`. `key` is the value of the key and `map` is the `Map` object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that this option completely overwrites the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
:   This option is a function that validates whether the keys of plain objects are safe. The function receives two arguments: `key` and `obj`. `key` is the value of the key and `obj` is the plain object being validated. If this function returns `false`, a `CborUnsafeMapKeyError` will be thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that this option completely overwrites the default validation. If you want to add your own validation to the default validation, you should also consider `"__proto__"` or `"constructor"` as unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of objects. Depth increases by 1 every time you enter an object or array. The default value is `64`. The encoding uses a recursive process, so there is no upper limit on the depth, but it is recommended to keep it small.

#### Return Value

A `Uint8Array` with the JavaScript value encoded in CBOR format.

### Examples

#### Protecting object keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting maximum depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
