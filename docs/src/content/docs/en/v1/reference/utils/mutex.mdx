---
title: mutex
slug: en/v1/reference/utils/mutex
---

import { Aside } from "@astrojs/starlight/components"

The `mutex` is a decorator that makes one or more class methods run asynchronously with concurrency of 1.

<Aside type="caution">
  This should not be a problem if you are using the built SDK for JavaScript, but if you are using the source code (TypeScript) of this SDK directly, you need decorator support for stage 3.
</Aside>

### Import

```ts
import { mutex } from "@tai-kun/surrealdb/utils";
```

### Usage

```ts
function mutex(
  target: (...args: any) => PromiseLike<any>,
  context: ClassMethodDecoratorContext,
): (this: any, ...args: any) => Promise<any>;
```

#### Arguments

##### `target`

This is the class method.

##### `context`

This is the decorator context for the stage 3 class method.

#### Return value

This is an asynchronous function with concurrency limited to 1.

#### Example

The following example shows how the hunting timing of asynchronous processing differs with and without `mutex`:

```ts
import { mutex } from "@tai-kun/surrealdb/utils";

class Runner {
  async runWithoutMutex(ms: number, value: string) {
    await sleep(ms);
    console.log(value);
  }

  @mutex
  async runWithMutex(ms: number, value: string) {
    await sleep(ms);
    console.log(value);
  }
}

const runner = new Runner();
// without mutex
await Promise.all([
  runner.runWithoutMutex(1000, "A"),
  runner.runWithoutMutex(500, "B"),
  runner.runWithoutMutex(0, "C"),
]);
// with mutex
await Promise.all([
  runner.runWithMutex(1000, "A"),
  runner.runWithMutex(500, "B"),
  runner.runWithMutex(0, "C"),
]);
```

Output:

```js
C
B
A
A
B
C
```
