---
title: TaskEmitter
slug: en/v1/reference/utils/task-emitter
---

import Badge from "~/components/en/Badge.astro";

`TaskEmitter` is an event emitter class for asynchronous tasks managed by the `TaskQueue`.

### Import

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";
```

### `.constructor()`

```ts
new TaskEmitter<T>();
```

#### Arguments

##### `T`

The type that defines the event names and the arguments (array) that each event takes in a key-value format.

#### Return Value

When called with `new`, `TaskEmitter` returns its instance.

### `.on()` <Badge variant="instance" /><Badge variant="method" />

`.on` is a function that registers an event listener to the event emitter. If you try to register the same function multiple times for the same event, all registrations except the first one will be ignored.

```ts
on(event: string | number, listener: TaskListener): void;
```

#### Arguments

##### `event`

The name of the event to which the event listener is registered.

##### `listener`

The event listener to be registered. This function receives the same arguments as the task runner of `TaskQueue`, followed by the arguments passed to `.emit` as a variable-length argument.

#### Return Value

None.

#### Example

The following example captures the "log" event and prints the value passed to the emitter to standard output:

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";

type Events = {
  log: string[];
};

const emitter = new TaskEmitter<Events>();

emitter.on("log", (_, ...args) => {
  console.log(...args);
});

emitter.emit("log", "Hello");
emitter.emit("log", "World", "!!!");

await emitter.idle();
```

Output:

```js
Hello
World !!!
```

### `.off()` <Badge variant="instance" /><Badge variant="method" />

`.off` is a function that unregisters an event listener from the event emitter. If the event listener is omitted, all event listeners registered to the target event name will be unregistered.

```ts
off(event: string | number, listener?: TaskListener): void;
```

#### Arguments

##### `event`

The name of the event to which the event listener is unregistered.

##### `listener`

The event listener to be unregistered. If this is omitted, all event listeners registered to the target `event` will be unregistered.

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

`.once` is similar to `.on` but captures the event only once. It also receives the value with the returned `StatefulPromise` instead of a callback function.

```ts
once(
  event: string | Number,
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>;
```

#### Example

The following example captures the "log" event only once and prints the value passed to the emitter to standard output:

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";

type Events = {
  log: string[];
};

const emitter = new TaskEmitter<Events>();

const promise = emitter.once("log");

emitter.emit("log", "Hello");
emitter.emit("log", "World", "!!!");

const recived = await promise;
console.log(recived);

await emitter.idle();
```

Output:

```js
[ 'Hello' ]
```

#### Arguments

##### `event`

The name of the event to wait for.

##### `options`

Options for the event listener. You can pass the abort signal.

#### Return Value

Returns a `StatefulPromise` that resolves with the argument (array) of `.emit`.

### `.emit()` <Badge variant="instance" /><Badge variant="method" />

`.emit` is a function that sends values to event listeners.

```ts
emit(
  event: string | number,
  ...args: unknown[]
): undefined | StatefulPromise<unknown>[];
```

#### Arguments

##### `event`

The name of the event to send to.

##### `args`

The value to be sent to the event listener.

#### Return Value

Returns `undefined` if there are no event listeners. If there are event listeners, it returns an array of `StatefulPromise` that wait until they are resolved/rejected. You usually don't need to handle this `StatefulPromise`. You can use it when you need to wait for the side effects caused by the event in the current context, or when you are interested in the resolution/rejection of the event listener.

### `.idle()` <Badge variant="instance" /><Badge variant="method" />

`.idle` is a function that waits for the completion of all currently running event listeners.

```ts
idle(): StatefulPromise<void>;
```

#### Arguments

None.

#### Return Value

Returns a `StatefulPromise` that resolves with `void`.

### `.abort()` <Badge variant="instance" /><Badge variant="method" />

`.abort` is a function that sends an abort event to the `signal` of all event listeners.

```ts
abort(reason?: unknown): void;
```

#### Arguments

##### `reason`

The reason for the abort.

#### Return Value

None.
