---
title: encode
slug: en/v2/api/cbor/encode
---

The `encode` function encodes a JavaScript value into a CBOR-formatted `Uint8Array`.

### Import

```ts
import { encode } from "@tai-kun/surrealdb/cbor";
```

### Syntax

```ts
function encode(value: unknown, options?: EncodeOptions): Uint8Array;
```

#### Arguments

##### `value`

The JavaScript value to encode into a CBOR-formatted `Uint8Array`. The following JavaScript values can be passed to `value`:

- Primitive values
  - `number`
  - `bigint`
  - `string`
  - `boolean`
  - `null`
  - `undefined`
- Objects with a `.toCBOR()` method
- Arrays or `Set`
- Plain objects or `Map`
- `Uint8Array`
- `Simple` objects
- Values that can be replaced with an optional `replacer`

If the value is not a primitive value and has a `toCBOR` property that is a function, it will be called preferentially.

##### `options`

Encoding options.

`replacer?: Replacer | Replacer[]`
:   The encoder encodes most values into CBOR by default. However, some special values may not fall into that category. You can replace those values with values that can be encoded. This option allows you to implement a replacement process by specifying a function or an array of functions. If the function returns the `CONTINUE` symbol obtained from `Symbol.for("@tai-kun/surrealdb/cbor/continue")`, the subsequent function is called. If no replacement is possible, a `SurrealTypeError` is thrown.

`isSafeMapKey?: (key: unknown, map: ReadonlyMap<unknown, unknown>) => boolean`
:   This option is a function that verifies whether the keys of a `Map` object are safe. The function takes two arguments: `key` and `map`. `key` is the value of the key, and `map` is the `Map` object being verified. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overwrites the default verification. If you want to add your own verification to the default verification, you should also consider `"__proto__"` or `"constructor"` to be unsafe keys.

`isSafeObjectKey?: (key: unknown, obj: { readonly [p: string]: unknown }) => boolean`
:   This option is a function that verifies whether the keys of a plain object are safe. The function takes two arguments: `key` and `obj`. `key` is the value of the key, and `obj` is the plain object being verified. If this function returns `false`, a `CborUnsafeMapKeyError` is thrown. By default, `"__proto__"` or `"constructor"` are considered unsafe keys. Note that specifying this option completely overwrites the default verification. If you want to add your own verification to the default verification, you should also consider `"__proto__"` or `"constructor"` to be unsafe keys.

`maxDepth?: number`
:   Specifies the maximum depth of an object. The depth increases by 1 for each object or array entered. The default value is `64`. Encoding does not use recursion, so there is no upper limit on depth, but it is recommended that you do not make it too large.

#### Return value

A `Uint8Array` containing the JavaScript value encoded in CBOR format.

### Examples

#### Protecting object keys with `isSafeObjectKey`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    "API_KEY": "***"
  },
  {
    isSafeObjectKey: k => !["constructor", "__proto__", "API_KEY"].includes(k),
  }
); // throws CborUnsafeMapKeyError
```

#### Replacing symbols with `replacer`

```ts
import { CONTINUE, encode } from "@tai-kun/surrealdb/cbor";

const bytes = encode(Symbol.for("ID"), {
  replacer(o) {
    switch (o) {
      case Symbol.for("ID"):
        return "ID";

      default:
        return CONTINUE;
    }
  },
});

console.log(bytes); // Uint8Array(3) [ 98, 73, 68 ]
```

#### Limiting the maximum depth with `maxDepth`

```ts
import { encode } from "@tai-kun/surrealdb/cbor";

encode(
  {
    // depth: 1
    a: new Map([
      // depth: 2
      ["b", [
        // depth: 3
        new Set([
          // depth: 4
        ]),
      ]],
    ]),
  },
  {
    maxDepth: 3,
  },
); // throws CborMaxDepthReachedError
```
