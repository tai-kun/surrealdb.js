---
title: TaskEmitter
slug: en/v2/api/utils/task-emitter
---

import Badge from "~/components/en/Badge.astro";

`TaskEmitter` is an event emitter class for asynchronous tasks managed by the `TaskQueue`.

### Import

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";
```

### `.constructor()`

```ts
new TaskEmitter<T>();
```

#### Arguments

##### `T`

A type that represents the event names and the arguments (array) that the events take in key-value pairs.

#### Return value

When invoked through `new`, `TaskEmitter` returns its instance.

### `.on()` <Badge variant="instance" /><Badge variant="method" />

`.on` is a function to register an event listener to the event emitter. If you try to register the same function multiple times for the same event, registration will be ignored except for the first time.

```ts
on(event: string | number, listener: TaskListener): void;
```

#### Arguments

##### `event`

The name of the event to which the event listener is registered.

##### `listener`

The event listener to be registered. This function is given the same arguments as the task runner of `TaskQueue`, followed by a variable number of arguments passed to `.emit`.

#### Return value

None.

#### Example

In the following example, we capture the "log" event and print the value passed to the emitter to standard output:

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";

type Events = {
  log: string[];
};

const emitter = new TaskEmitter<Events>();

emitter.on("log", (_, ...args) => {
  console.log(...args);
});

emitter.emit("log", "Hello");
emitter.emit("log", "World", "!!!");

await emitter.idle();
```

Output:

```js
Hello
World !!!
```

### `.off()` <Badge variant="instance" /><Badge variant="method" />

`.off` is a function to unregister an event listener from the event emitter. If you omit the event listener, all event listeners registered for the target event name will be unregistered.

```ts
off(event: string | number, listener?: TaskListener): void;
```

#### Arguments

##### `event`

The name of the event from which the event listener is to be unregistered.

##### `listener`

The event listener to be unregistered. If this is omitted, all event listeners registered for the target `event` will be unregistered.

#### Return value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

`.once` is similar to `.on`, but it catches events only once. It also receives the value not as a callback function, but as a `StatefulPromise` in the return value.

```ts
once(
  event: string | Number,
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>;
```

#### Example

In the following example, we capture the "log" event only once and print the value passed to the emitter to standard output:

```ts
import { TaskEmitter } from "@tai-kun/surrealdb/utils";

type Events = {
  log: string[];
};

const emitter = new TaskEmitter<Events>();

const promise = emitter.once("log");

emitter.emit("log", "Hello");
emitter.emit("log", "World", "!!!");

const recived = await promise;
console.log(recived);

await emitter.idle();
```

Output:

```js
[ 'Hello' ]
```

#### Arguments

##### `event`

The name of the event to wait for.

##### `options`

Options for the event listener. You can pass a cancellation signal.

#### Return value

Returns a `StatefulPromise` that is resolved with the arguments (array) of `.emit`.

### `.emit()` <Badge variant="instance" /><Badge variant="method" />

`.emit` is a function to send a value to an event listener.

```ts
emit(
  event: string | number,
  ...args: unknown[]
): undefined | StatefulPromise<unknown>[];
```

#### Arguments

##### `event`

The name of the event to send to.

##### `args`

The value to be sent to the event listener.

#### Return value

Returns `undefined` if no event listener is found. If an event listener is found, it returns an array of `StatefulPromise` that wait until it is resolved/rejected. Usually you don't need to handle this `StatefulPromise`. It can be used when you need to wait for the side effects caused by the event in the current context, or when you are interested in resolving/rejecting the event listener.

### `.idle()` <Badge variant="instance" /><Badge variant="method" />

`.idle` is a function to wait for the completion of all currently running event listeners.

```ts
idle(): StatefulPromise<void>;
```

#### Arguments

None.

#### Return value

Returns a `StatefulPromise` that resolves with `void`.

### `.abort()` <Badge variant="instance" /><Badge variant="method" />

`.abort` is a function to send an abort event to the `signal` of all event listeners.

```ts
abort(reason?: unknown): void;
```

#### Arguments

##### `reason`

The reason for the cancellation.

#### Return value

None.
