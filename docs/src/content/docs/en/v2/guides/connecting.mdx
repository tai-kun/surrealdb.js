---
title: Connecting
---

import Badge from "~/components/en/Badge.astro";

### Importing

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When invoked via `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous, but will not be executed concurrently with other `.connect()` or `.close()` within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

The SurrealDB endpoint URL. If the URL path does not end with `/rpc`, it will be automatically appended. Thus, passing `http://localhost:8000` will connect to `http://localhost:8000/rpc`.

##### `options`

Connection options.

`signal?: AbortSignal`
:   The abort signal to abort the connection. Defaults to an abort signal that times out in 15 seconds.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

It is not possible to connect to a different endpoint without disconnecting using `.close()`. The connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

Since `.connect()` is not executed concurrently in the context of asynchronous processing, the following example will also fail to connect. Usually, it is unknown which endpoint will establish the connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects the connection to SurrealDB. It will not throw an error if it is not yet connected or has already been disconnected. This method is asynchronous, but will not be executed concurrently with `.connect()` or other `.close()` within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Disconnection options.

`force?: boolean`
:   If `true`, it sends an abort signal to the abort signal passed to the `Surreal` object's event listeners. Event listeners are expected to abort immediately even if processing is incomplete.

`signal?: AbortSignal`
:   The abort signal to abort the connection. Defaults to an abort signal that times out in 15 seconds.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves connection information. Connection information always holds a value that is a copy of the internal information. Therefore, the connection information includes a `URL` object, but modifying it directly will not change the information about the endpoint held internally by the `Surreal` object. It is `undefined` if a connection has not yet been requested.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns connection information if a connection is established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   The current connection state as a number. Each number indicates the following meaning:

`endpoint: URL | null`
:   The connected endpoint. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace has been selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database has been selected.

`token: string | null`
:   The currently authenticated token. It is `null` if not signed up or signed in.

The possible values for connection information in each connection state are shown in the following table:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The current connection state as a number.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it is `"closed"` (not `undefined`) even if the connection is not established.

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The connected endpoint. It is `null` only in the disconnected state. It is `undefined` if a connection is not established.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace has been selected. It is `undefined` if a connection is not established.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database has been selected. It is `undefined` if a connection is not established.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if not signed up or signed in. It is `undefined` if a connection is not established.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   The event that occurs when the connection information transitions or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   The event that occurs when an RPC response occurs in bidirectional communication. Currently only used in the WebSocket protocol and not in the HTTP protocol. `RpcMethod` is the PRC method name such as `ping` or `use`. `number` is an identifier used to associate request/response in bidirectional communication, and it takes an integer from 1 to 2^53-1.

`live_${string}`
:   The event that occurs when an event is received from a live query. Currently only used in the WebSocket protocol and not in the HTTP protocol. `string` is the UUID of the live query.

`error`
:   The error event. Currently only used in the WebSocket protocol and not in the HTTP protocol.

##### `listener`

The function to be executed when the event occurs. See also [Task Emitter](/en/reference/utils/task-emitter#on). The value passed to `eventArgs` varies depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Live query in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Live query in differential fetch mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/en/reference/errors/#httpengineerror)
    - [`WebSocketEngineError`](/en/reference/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but only catches the event once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` of `.on()`.

##### `options`

Task listener options. See [Task Emitter](/en/reference/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener of `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to remove the event listener for.

##### `listener`

The event listener to remove.

#### Return Value

None.
