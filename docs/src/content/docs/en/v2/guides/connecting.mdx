---
title: Connecting
slug: en/v2/guides/connecting
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called via `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous, but it will not be executed concurrently with other `.connect()` or `.close()` calls within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for connecting.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal with a timeout of 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

Connecting to a different endpoint without disconnecting with `.close()` is not possible. However, the connection to the endpoint that was established first will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: An attempt was made to connect to ws://localhost:1129/rpc while ws://localhost:8000/rpc was already connected.
```

Since `.connect()` is not executed concurrently in an asynchronous context, the following example will also fail to connect. Typically, it is not possible to determine which endpoint establishes a connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects the connection to SurrealDB. It will not throw an error if the connection is not yet established or has already been disconnected. This method is asynchronous, but it will not be executed concurrently with `.connect()` or other `.close()` calls within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If `true`, it will send an abort signal to the abort signal passed to the `Surreal` object's event listener. The event listener is expected to interrupt immediately even if processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal with a timeout of 15 seconds is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects the connection:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Gets the connection information. The connection information always holds a value that is a copy of the internal information. Therefore, the connection information includes a `URL` object, but directly modifying it will not change the endpoint information that the `Surreal` object holds internally. If the connection has not yet been requested, it will be `undefined`.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if a connection is established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   Indicates the current connection state. Each number indicates the following meaning:

`endpoint: URL | null`
:   The endpoint to which the connection is made. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if you are not signed up or signed in.

The possible values of the connection information in each connection state are shown in the following table:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

Indicates the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, even if the connection is not established, it will be `"closed"` (not `undefined`).

Related: Refer also to [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to which the connection is made. It is `null` only in the disconnected state. If the connection is not established, it is `undefined`.

```ts
endpoint: string | null | undefined
```

Related: Refer also to [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. If the connection is not established, it is `undefined`.

```ts
namespace: string | null | undefined
```

Related: Refer also to [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. If no database is selected, it is `null`. If the connection is not established, it is `undefined`.

```ts
database: string | null | undefined
```

Related: Refer also to [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if you are not signed up or signed in. If the connection is not established, it is `undefined`.

```ts
token: string | null | undefined
```

Related: Refer also to [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   Events that occur when the connection information transitions, or when the transition fails.

`rpc_${RpcMethod}_${number}`
:   Events that occur when an RPC response occurs in bidirectional communication. `RpcMethod` is the name of the PRC method, such as `ping` or `use`. `number` is an identifier for associating request/response in bidirectional communication, and takes an integer from 1 to 2^53-1. It is fixed at 0 for HTTP.

`live_${string}`
:   Events that occur when a live query event is received. Currently used only with the WebSocket protocol, this event is not used with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   Error events. Currently used only with the WebSocket protocol, this event is not used with the HTTP protocol.

##### `listener`

The function to execute when the event occurs. See also [Task Emitter](/v2/api/utils/task-emitter#on). The values passed to `eventArgs` vary depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Normal mode live query:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object, record: string | object }`
:   Incremental mode live query:
:   - `{ action: "CREATE" | "UPDATE", result: object[], record: string | object }`
    - `{ action: "DELETE", result: object, record: string | object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/v2/api/errors/#httpengineerror)
    - [`WebSocketEngineError`](/v2/api/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but only catches the event once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as `event` in `.on()`.

##### `options`

Task listener options. Refer to [Task Emitter](/v2/api/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes the event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to unregister the event listener from.

##### `listener`

The event listener to unregister.

#### Return Value

None.
