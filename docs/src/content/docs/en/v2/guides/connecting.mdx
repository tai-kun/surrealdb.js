---
title: Connection
---

import Badge from "~/components/en/Badge.astro";

### Import

```ts
import { Surreal } from "@tai-kun/surrealdb";
```

### `.constructor()`

```ts
new Surreal();
```

#### Arguments

None.

#### Return Value

When called through `new`, `Surreal` returns its instance.

### `.connect()` <Badge variant="instance" /><Badge variant="method" />

Connects to the SurrealDB endpoint. This method is asynchronous but does not execute concurrently with other `.connect()` or `.close()` within the same instance.

```ts
connect(
  endpoint: string | URL,
  options?: ClientConnectOptions,
): Promise<void>;
```

#### Arguments

##### `endpoint`

Specifies the SurrealDB endpoint as a URL. If the URL path does not end with `/rpc`, it will be automatically appended. Therefore, passing `http://localhost:8000` as an argument will connect to `http://localhost:8000/rpc`.

##### `options`

Options for connecting.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal with a 15-second timeout is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
```

It is not possible to connect to a different endpoint without disconnecting using `.close()`. Note that the connection to the previously established endpoint will be maintained:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.connect("ws://localhost:1129"); // throws ConnectionConflictError: Connection conflict between ws://localhost:8000/rpc and ws://localhost:1129/rpc.
```

`.connect()` does not execute concurrently in the context of asynchronous processing, so the following example will also fail to connect. Typically, it is unclear which endpoint establishes a connection first, so the error message may vary:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await Promise.all([
  db.connect("ws://localhost:8000"),
  db.connect("ws://localhost:1129"),
]); // throws ConnectionConflictError
```

### `.close()` <Badge variant="instance" /><Badge variant="method" />

Disconnects from SurrealDB. It does not throw an error if the connection is not yet established or has already been disconnected. This method is asynchronous but does not execute concurrently with `.connect()` or other `.close()` within the same instance.

```ts
close(options?: ClientCloseOptions): Promise<void>
```

#### Arguments

##### `options`

Options for disconnecting.

`force?: boolean`
:   If `true`, it sends an abort signal to the abort signal passed to the `Surreal` object's event listeners. Event listeners are expected to be immediately interrupted even if the processing is incomplete.

`signal?: AbortSignal`
:   An abort signal to interrupt the connection. By default, an abort signal with a 15-second timeout is set.

#### Return Value

Returns a `Promise` object that resolves to `undefined`.

#### Example

The following example connects to SurrealDB using the WebSocket protocol and then disconnects from it:

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();

await db.connect("ws://localhost:8000");
await db.close();
```

### `.getConnectionInfo()` <Badge variant="instance" /><Badge variant="method" />

Retrieves connection information. The connection information always has internally copied values. Therefore, while connection information includes a `URL` object, directly modifying it will not change the endpoint information stored internally by the `Surreal` object. If a connection has not yet been requested, it will be `undefined`.

```ts
getConnectionInfo(): ConnectionInfo | undefined;
```

#### Arguments

None.

#### Return Value

Returns the connection information if a connection has been established. Otherwise, it returns `undefined`. The connection information includes the following items:

`state: "connecting" | "open" | "closing" | "closed"`
:   A numerical value indicating the current connection state. Each value has the following meaning:

`endpoint: URL | null`
:   The endpoint to which the connection is established. It is `null` only in the disconnected state.

`namespace: string | null`
:   The currently selected namespace. It is `null` if no namespace is selected.

`database: string | null`
:   The currently selected database name. It is `null` if no database is selected.

`token: string | null`
:   The currently authenticated token. It is `null` if no signup or signin has occurred.

The possible values of connection information for each connection state are as follows:

| state          | endpoint | namespace      | database       | token          |
| -------------- | -------- | -------------- | -------------- | -------------- |
| `"connecting"` | `URL`    | `null`         | `null`         | `null`         |
| `"open"`       | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closing"`    | `URL`    | `string\|null` | `string\|null` | `string\|null` |
| `"closed"`     | `null`   | `null`         | `null`         | `null`         |

### `.state` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

A numerical value indicating the current connection state.

```ts
state: "connecting" | "open" | "closing" | "closed"
```

For convenience, it will be `"closed"` (not `undefined`) even if a connection is not established.

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.endpoint` <Badge variant="instance" /><Badge variant="property" /><Badge variant="readonly" />

The endpoint to which the connection is established. It is `null` only in the disconnected state. If a connection is not established, it is `undefined`.

```ts
endpoint: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.namespace` <Badge variant="instance" /><Badge variant="property" />

The currently selected namespace. It is `null` if no namespace is selected. If a connection is not established, it is `undefined`.

```ts
namespace: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.database` <Badge variant="instance" /><Badge variant="property" />

The currently selected database name. It is `null` if no database is selected. If a connection is not established, it is `undefined`.

```ts
database: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.token` <Badge variant="instance" /><Badge variant="property" />

The currently authenticated token. It is `null` if no signup or signin has occurred. If a connection is not established, it is `undefined`.

```ts
token: string | null | undefined
```

Related: See also [`.getConnectionInfo()`](#getconnectioninfo).

### `.on()` <Badge variant="instance" /><Badge variant="method" />

Registers an event listener.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to monitor.

`"connecting" | "open" | "closing" | "closed"`
:   Events that occur when connection information transitions or when a transition fails.

`rpc_${RpcMethod}_${number}`
:   An event that occurs when an RPC response in bidirectional communication is received. Currently, it is only used with the WebSocket protocol and not with the HTTP protocol. `RpcMethod` is the name of the PRC method, such as `ping` or `use`. `number` is an identifier to associate requests and responses in bidirectional communication, and it takes an integer from 1 to 2^53-1.

`live_${string}`
:   An event that occurs when an event from a live query is received. Currently, it is only used with the WebSocket protocol and not with the HTTP protocol. `string` is the UUID of the live query.

`error`
:   An error event. Currently, it is only used with the WebSocket protocol and not with the HTTP protocol.

##### `listener`

A function that is executed when the event occurs. See also [Task Emitter](/v2/api/utils/task-emitter#on). The values passed to `eventArgs` vary depending on the event.

`"connecting" | "open" | "closing" | "closed"`
:   One of the following:
:   - `{ state: "connecting" | "open" | "closing" | "closed" }`
    - `{ state: "connecting" | "open" | "closing" | "closed", error: unknown }`

`rpc_${RpcMethod}_${number}`
:   One of the following:
:   - `{ id: string, result: unknown }`
    - `{ id: string, error: { code: number, message: string } }`

`live_${string}`
:   Live query in normal mode:
:   - `{ action: "CREATE" | "UPDATE" | "DELETE", result: object }`
:   Live query in differential retrieval mode:
:   - `{ action: "CREATE" | "UPDATE", result: object[] }`
    - `{ action: "DELETE", result: object }`

`error`
:   One of the following:
:   - [`HttpEngineError`](/v2/api/errors/#httpengineerror)
    - [`WebSocketEngineError`](/v2/api/errors/#websocketengineerror)

#### Return Value

None.

### `.once()` <Badge variant="instance" /><Badge variant="method" />

Similar to `.on()`, but it captures the event only once.

```ts
once(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  options?: TaskListenerOptions,
): StatefulPromise<unknown[]>
```

#### Arguments

##### `event`

Same as the `event` in `.on()`.

##### `options`

Task listener options. See [Task Emitter](/v2/api/utils/task-emitter#once).

#### Return Value

Returns a `StatefulPromise` that resolves with the `eventArgs` of the task listener in `.on()`.

### `.off()` <Badge variant="instance" /><Badge variant="method" />

Removes an event listener registered with `.on()`.

```ts
off(
  event:
    | "connecting" | "open" | "closing" | "closed"
    | `rpc_${RpcMethod}_${number}`
    | `live_${string}`
    | "error",
  listener: (taskRunnerArgs, ...eventArgs) => void | PromiseLike<void>,
): void
```

#### Arguments

##### `event`

The name of the event to remove the event listener for.

##### `listener`

The event listener to remove.

#### Return Value

None.
