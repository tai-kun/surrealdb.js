---
title: 认证
slug: zh-CN/v2/guides/authentication
---

import Badge from "~/components/zh-CN/Badge.astro";

SurrealDB 支持两种认证方式：用户名和密码认证以及自定义认证。用户名和密码认证需要使用 [`DEFINE USER`](https://surrealdb.com/docs/surrealdb/surrealql/statements/define/user) 语句定义的用户名和密码。自定义认证使用 [`DEFINE ACCESS`](https://surrealdb.com/docs/surrealdb/surrealql/statements/define/access) 语句定义。在本指南中，我们将前者称为“用户认证”，后者称为“访问认证”。

### `.signin()` <Badge variant="instance" /><Badge variant="method" />

使用用户认证或访问认证登录 SurrealDB。

```ts
signin(auth: Auth, options?: ClientRpcOptions): Promise<Jwt>;
```

#### 参数

##### `auth`

用户认证或访问认证所需的信息。每种认证类型所需的参数如下：

| 认证类型 | 参数 |
| --- | ---|
| 根用户 | `{ user: string, pass: string }` |
| 命名空间用户 | `{ user: string, pass: string, ns: string }` |
| 数据库用户 | `{ user: string, pass: string, ns: string, db: string }` |
| 访问 | `{ ac: string, ns: string, db: string, [param: string]: unknown }` |

访问认证通常需要定义的访问 (`ac`) 以及其他参数。

##### `options`

PRC 请求的选项。

#### 返回值

返回一个 `Jwt` 类型的值，并通过 `Promise` 对象进行解析。

#### 示例

以下示例使用根用户登录 SurrealDB：

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
await db.connect("ws://localhost:8000");

const jwt = await db.signin({
  user: "root",
  pass: "passw0rd",
});

console.log(jwt.issuedAt);  // e.g. 1722749786
console.log(jwt.expiresAt); // e.g. 1722753386
console.log(jwt.namespace); // undefined
console.log(jwt.database);  // undefined
console.log(jwt.access);    // undefined
console.log(jwt.user);      // 'root'

console.log(jwt.raw);             // 'eyJ0eXAiOiJKV1QiLCJhb ... '
console.log(JSON.stringify(jwt)); // '"[REDACTED]"'

await db.close();
```

以下示例使用命名空间用户登录 SurrealDB：

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
await db.connect("ws://localhost:8000");

const jwt = await db.signin({
  ns: "my_namespace",
  user: "ns_user",
  pass: "passw0rd",
});

console.log(jwt.namespace); // 'my_namespace'
console.log(jwt.database);  // undefined
console.log(jwt.access);    // undefined
console.log(jwt.user);      // 'ns_user'

await db.close();
```

以下示例使用数据库用户登录 SurrealDB：

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
await db.connect("ws://localhost:8000");

const jwt = await db.signin({
  ns: "my_namespace",
  db: "my_database",
  user: "db_user",
  pass: "passw0rd",
});

console.log(jwt.namespace); // 'my_namespace'
console.log(jwt.database);  // 'my_database'
console.log(jwt.access);    // undefined
console.log(jwt.user);      // 'db_user'

await db.close();
```

以下示例使用记录访问登录 SurrealDB。`.user` 属性将设置为记录 ID：

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
await db.connect("ws://localhost:8000");

const jwt = await db.signin({
  ns: "my_namespace",
  db: "my_database",
  ac: "account",
  // ...parmeters
});

console.log(jwt.namespace); // 'my_namespace'
console.log(jwt.database);  // 'my_database'
console.log(jwt.access);    // 'account'
console.log(jwt.user);      // e.g. 'user:⟨tai-kun⟩'

await db.close();
```

### `.signup()` <Badge variant="instance" /><Badge variant="method" />

使用访问认证注册 SurrealDB。

```ts
signup(auth: RecordAccessAuth, options?: ClientRpcOptions): Promise<Jwt>;
```

#### 参数

##### `auth`

访问认证所需的信息。

##### `options`

PRC 请求的选项。

#### 返回值

返回一个 `Jwt` 类型的值，并通过 `Promise` 对象进行解析。

#### 示例

```ts
import { Surreal } from "@tai-kun/surrealdb";

const db = new Surreal();
await db.connect("ws://localhost:8000");

const jwt = await db.signup({
  ns: "my_namespace",
  db: "my_database",
  ac: "account",
  // ...parmeters
});

console.log(jwt.namespace); // 'my_namespace'
console.log(jwt.database);  // 'my_database'
console.log(jwt.access);    // 'account'
console.log(jwt.user);      // e.g. 'user:⟨tai-kun⟩'

await db.close();
```

### `.authenticate()` <Badge variant="instance" /><Badge variant="method" />

使用 JWT 认证当前连接。

```ts
authenticate(token: string | Jwt, options?: ClientRpcOptions): Promise<void>
```

#### 参数

##### `token`

要认证的 JWT。

##### `options`

RPC 请求的选项。

#### 返回值

返回一个 `undefined` 类型的值，并通过 `Promise` 对象进行解析。

### `.invalidate()` <Badge variant="instance" /><Badge variant="method" />

使当前连接的认证失效。

```ts
invalidate(options?: ClientRpcOptions): Promise<void>
```

#### 参数

##### `options`

RPC 请求的选项。

#### 返回值

返回一个 `undefined` 类型的值，并通过 `Promise` 对象进行解析。

{/* ### `.info()` <Badge variant="instance" /><Badge variant="method" />

#### 参数

#### 返値 */}
